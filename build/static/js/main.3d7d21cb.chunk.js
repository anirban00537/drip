(this.webpackJsonpdrip=this.webpackJsonpdrip||[]).push([[0],{44:function(e,t,o){},76:function(e,t,o){"use strict";o.r(t);var n=o(0),c=o(1),i=o.n(c),r=o(36),s=o.n(r),a=(o(44),o(38)),d=o(17),l=o(2),u=o(10),m=o(11),p=o(13),f=o(12),h=o(37),v=o.n(h),b=function(e){Object(p.a)(o,e);var t=Object(f.a)(o);function o(e){var n;return Object(u.a)(this,o),(n=t.call(this,e)).state={},n}return Object(m.a)(o,[{key:"componentDidMount",value:function(){this.props.videoStream&&(this.video.srcObject=this.props.videoStream)}},{key:"componentWillReceiveProps",value:function(e){console.log(e.videoStream),e.videoStream&&e.videoStream!==this.props.videoStream&&(this.video.srcObject=e.videoStream)}},{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{style:Object(l.a)({},this.props.frameStyle),children:Object(n.jsx)("video",{id:this.props.id,muted:this.props.muted,autoPlay:!0,style:Object(l.a)({},this.props.videoStyles),ref:function(t){e.video=t}})})}}]),o}(c.Component),S=function(e){Object(p.a)(o,e);var t=Object(f.a)(o);function o(e){var n;return Object(u.a)(this,o),(n=t.call(this,e)).state={rVideos:[],remoteStreams:[]},n}return Object(m.a)(o,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(this.props.remoteStreams!==e.remoteStreams){var o=e.remoteStreams.map((function(e,o){var c=Object(n.jsx)(b,{videoStream:e.stream,frameStyle:{width:120,float:"left",padding:"0 3px"},videoStyles:{cursor:"pointer",objectFit:"cover",borderRadius:3,width:"100%"}});return Object(n.jsx)("div",{id:e.name,onClick:function(){return t.props.switchVideo(e)},style:{display:"inline-block"},children:c},o)}));this.setState({remoteStreams:e.remoteStreams,rVideos:o})}}},{key:"render",value:function(){return Object(n.jsx)("div",{style:{zIndex:3,position:"fixed",padding:"6px 3px",backgroundColor:"rgba(0,0,0,0.3)",maxHeight:120,top:"auto",right:10,left:10,bottom:10,overflowX:"scroll",whiteSpace:"nowrap"},children:this.state.rVideos})}}]),o}(c.Component),j=function(e){Object(p.a)(o,e);var t=Object(f.a)(o);function o(e){var n;return Object(u.a)(this,o),(n=t.call(this,e)).getLocalStream=function(){navigator.mediaDevices.getUserMedia({video:!0,options:{mirror:!0}}).then((function(e){window.localStream=e,n.setState({localStream:e}),n.whoisOnline()})).catch((function(e){console.log("getUserMedia Error: ",e)}))},n.whoisOnline=function(){n.sendToPeer("onlinePeers",null,{local:n.socket.id})},n.sendToPeer=function(e,t,o){n.socket.emit(e,{socketID:o,payload:t})},n.createPeerConnection=function(e,t){try{var o=new RTCPeerConnection(n.state.pc_config),c=Object(l.a)(Object(l.a)({},n.state.peerConnections),{},Object(d.a)({},e,o));n.setState({peerConnections:c}),o.onicecandidate=function(t){t.candidate&&n.sendToPeer("candidate",t.candidate,{local:n.socket.id,remote:e})},o.oniceconnectionstatechange=function(e){},o.ontrack=function(t){var o={id:e,name:e,stream:t.streams[0]};n.setState((function(e){var n=e.remoteStreams.length>0?{}:{remoteStream:t.streams[0]},c=e.remoteStreams.filter((function(t){return t.id===e.selectedVideo.id}));return c=c.length?{}:{selectedVideo:o},Object(l.a)(Object(l.a)(Object(l.a)({},c),n),{},{remoteStreams:[].concat(Object(a.a)(e.remoteStreams),[o])})}))},o.close=function(){},n.state.localStream&&o.addStream(n.state.localStream),t(o)}catch(i){console.log("Something went wrong! pc not created!!",i),t(null)}},n.componentDidMount=function(){n.socket=v.a.connect(n.serviceIP,{path:"/io/webrtc",query:{}}),n.socket.on("connection-success",(function(e){n.getLocalStream(),console.log(e.success);var t=e.peerCount>1?"Total Connected Peers: ".concat(e.peerCount):"Waiting for other peers to connect";n.setState({status:t})})),n.socket.on("peer-disconnected",(function(e){console.log("peer-disconnected",e);var t=n.state.remoteStreams.filter((function(t){return t.id!==e.socketID}));n.setState((function(o){var n=o.selectedVideo.id===e.socketID&&t.length?{selectedVideo:t[0]}:null;return Object(l.a)({remoteStreams:t},n)}))})),n.socket.on("online-peer",(function(e){console.log("connected peers ...",e),n.createPeerConnection(e,(function(t){t&&t.createOffer(n.state.sdpConstraints).then((function(o){t.setLocalDescription(o),n.sendToPeer("offer",o,{local:n.socket.id,remote:e})}))}))})),n.socket.on("offer",(function(e){n.createPeerConnection(e.socketID,(function(t){t.addStream(n.state.localStream),t.setRemoteDescription(new RTCSessionDescription(e.sdp)).then((function(){t.createAnswer(n.state.sdpConstraints).then((function(o){t.setLocalDescription(o),n.sendToPeer("answer",o,{local:n.socket.id,remote:e.socketID})}))}))}))})),n.socket.on("answer",(function(e){var t=n.state.peerConnections[e.socketID];console.log(e.sdp),t.setRemoteDescription(new RTCSessionDescription(e.sdp)).then((function(){}))})),n.socket.on("candidate",(function(e){var t=n.state.peerConnections[e.socketID];t&&t.addIceCandidate(new RTCIceCandidate(e.candidate))}))},n.switchVideo=function(e){console.log(e),n.setState({selectedVideo:e})},n.state={localStream:null,remoteStream:null,remoteStreams:[],peerConnections:{},selectedVideo:null,status:"Please wait...",pc_config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdpConstraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},n.serviceIP="http://localhost:8080/webrtcPeer",n.socket=null,n}return Object(m.a)(o,[{key:"render",value:function(){console.log(this.state.localStream);var e=Object(n.jsx)("div",{style:{color:"yellow",padding:5},children:this.state.status});return Object(n.jsxs)("div",{children:[Object(n.jsx)(b,{videoStyles:{zIndex:2,position:"absolute",right:0,width:200,height:200,margin:5,backgroundColor:"black"},videoStream:this.state.localStream,autoPlay:!0,muted:!0}),Object(n.jsx)(b,{videoStyles:{zIndex:1,position:"fixed",bottom:0,minWidth:"100%",minHeight:"100%",backgroundColor:"black"},videoStream:this.state.selectedVideo&&this.state.selectedVideo.stream,autoPlay:!0}),Object(n.jsx)("br",{}),Object(n.jsx)("div",{style:{zIndex:3,position:"absolute",margin:10,backgroundColor:"#cdc4ff4f",padding:10,borderRadius:5},children:e}),Object(n.jsx)("div",{children:Object(n.jsx)(S,{switchVideo:this.switchVideo,remoteStreams:this.state.remoteStreams})}),Object(n.jsx)("br",{})]})}}]),o}(c.Component),g=function(e){e&&e instanceof Function&&o.e(3).then(o.bind(null,77)).then((function(t){var o=t.getCLS,n=t.getFID,c=t.getFCP,i=t.getLCP,r=t.getTTFB;o(e),n(e),c(e),i(e),r(e)}))};s.a.render(Object(n.jsx)(i.a.StrictMode,{children:Object(n.jsx)(j,{})}),document.getElementById("root")),g()}},[[76,1,2]]]);
//# sourceMappingURL=main.3d7d21cb.chunk.js.map